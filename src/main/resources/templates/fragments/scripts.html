<script type="text/javascript" th:src="@{#{webjars.zxcvbn.js}}"></script>
<script type="text/javascript" th:src="@{#{webjars.jqueryui.js}}"></script>
<script type="text/javascript" th:src="@{#{webjars.jquerycookie.js}}"></script>
<script src="//www.google.com/recaptcha/api.js" async defer th:if="${recaptchaSiteKey}"></script>
<!--<script src="https//www.recaptcha.net/recaptcha/api.js" async defer th:if="${recaptchaSiteKey}"></script>-->
<script th:src="@{#{webjars.bootstrapmin.js}}"></script>

<script th:src="@{#{webjars.headmin.js}}"></script>
<script th:src="@{#{webjars.storemin.js}}"></script>
<script type="text/javascript" th:src="@{${#themes.code('cas.javascript.file')}}"></script>
<script type="text/javascript" th:src="@{${#themes.code('cas.javascript.zTreeCorefile')}}"></script>
<script type="text/javascript" th:src="@{${#themes.code('cas.javascript.zTreeExcheckfile')}}"></script>
<script type="text/javascript" th:src="@{${#themes.code('cas.javascript.security')}}"></script>
<!--<script type="text/javascript" src="js/cas.js"></script>-->

<script th:inline="javascript">
head.ready(document, function () {
    if (!window.jQuery) {
    	var jqueryUrl = /*[[@{#{webjars.jquerymin.js}}]]*/; 
        head.load(jqueryUrl, loadjQueryUI);
    } else {
        if(typeof(resourceLoadedSuccessfully)!="undefined"){
            notifyResourcesAreLoaded(resourceLoadedSuccessfully);
        }
    }
});

function loadjQueryUI() {
	var jqueryUrl = /*[[@{#{webjars.jqueryui.js}}]]*/; 
	head.load(jqueryUrl, loadjQueryCookies);
}


function changeCaptcha(){
    $("#Captcha").val('');
    var rmd = Math.random();
    var codeSrc = /*[[@{/captcha}]]*/;
    $("#captchaCode").attr('src',codeSrc+'?rmd='+rmd);
    //$("#captchaCode").attr('src',"/cas/captcha?rmd="+rmd);
}

function regPwdUrl(){
    $.ajax({
        type: "GET",
        url: /*[[@{/regPwdUrl}]]*/,
        dataType: "json",
        success: function(data){
            $("#registeruser").attr('href',data.regUrl);
            $("#forgotpwd").attr('href',data.pwdUrl);
        }
    });
}
//获取公钥的 modulus 和 exponent
function modulusExponent(){
    $.ajax({
        type: "GET",
        url: /*[[@{/modulusExponent}]]*/,
        dataType: "json",
        success: function(data){
            $("#hid_modulus").val(data.modulus);
            $("#hid_exponent").val(data.exponent);
        }
    });
}


function displayMesg() {
    $(".alert-danger").css('display','none');
}
/**
 *个人注册
 */
function grLogin() {
    $("#logintype").val("grlogin");
    var oLigr = $("#grlogin");
    var oLifr = $("#frlogin");
    var inputorg = $("#orgcode");
    var organimg = $("#organimg");
    inputorg.css('display','none');
    organimg.css('display','none');
    oLifr.css({"background":"rgba(0, 0, 0, 0.03)","color":"#787878"});
    oLigr.css({"background":"white","color":"black"});
    $('#registeruser').attr('href','https://puser.zjzwfw.gov.cn/sso/usp.do?action=register&servicecode=zjdlxxggfw');
    $('#forgotpwd').attr('href','https://puser.zjzwfw.gov.cn/sso/usp.do?action=forgotPwd&servicecode=zjdlxxggfw');
}

/**
 * 法人注册
 */
function frLogin() {
    $("#logintype").val("frlogin");
    var oLigr = $("#grlogin");
    var oLifr = $("#frlogin");
    var inputorg = $("#orgcode");
    var organimg = $("#organimg");
    inputorg.css('display','block');
    organimg.css('display','block');
    oLigr.css({"background":"rgba(0, 0, 0, 0.03)","color":"#787878"});
    oLifr.css({"background":"white","color":"black"});
    $('#registeruser').attr('href','https://uuser.zjzwfw.gov.cn/jsp/client/uuuser/uuuserRegistStep1.jsp');
    $('#forgotpwd').attr('href','https://uuser.zjzwfw.gov.cn/jsp/client/login/forgetPassword.jsp');
}

function showregedit(){
    $("#regeditmenu").css('display','block');
}
function hideregedit(){
    $("#regeditmenu").css('display','none');
}
function showgrregedit() {
    window.open("https://puser.zjzwfw.gov.cn/sso/usp.do?action=register&servicecode=zjdlxxggfw", "_blank");
}
function showfrregedit() {
    window.open("https://uuser.zjzwfw.gov.cn/jsp/client/uuuser/uuuserRegistStep1.jsp", "_blank");
}
var setting ={
    check: {
        enable: true,
            chkboxType: { "Y": "ps", "N": "ps" }
    },
    view: {
        dblClickExpand: true,
            showIcon: false,
            showTitle: true,
            txtSelectedEnable: true
    },
    data: {
        simpleData: {
            enable: true
        }
    },
    async: {
        enable: true,
        url:/*[[@{/getOrg}]]*/,
        //url: "http://dlxxbs.zjzwfw.gov.cn/ReportServer/rest/function/org/get",
        autoParam: ["id=orgcoding"],//变化参数
        //otherParam:{"otherParam":"zTreeAsyncTest"},固定参数
        type: "get",
        dataType:'json',
        dataFilter: filterOrg
    },
    callback: {
        onClick: onClickOrg
    }
}

function filterOrg(treeId, parentNode, childNodes) {
    var nodes = [];
    $.each(childNodes.result, function (i, m) {
        var pid;
        if (m.orgcoding.length == 3)
            pid = "0";
        else
            pid = m.orgcoding.substring(0, m.orgcoding.length - 3);
        nodes.push({
            id: m.orgcoding,
            pId: pid,
            devcoding: m.devcoding,
            name: m.orgname,
            isParent: true,
            nocheck:true
        });
    });
    $("#menuContent").children("img").remove();
    return nodes;
}

function onClickOrg(e, treeId, treeNode) {
    $("#orgcode").val(treeNode.name);//设置组织名称,显示
    $("#orgcodeVal").val(treeNode.id);//设置组织编号,传值
    $("#devcodingVal").val(treeNode.devcoding);//设置组织域名,传值
    hideMenu();
}

function initZTree() {
    $("#orgcode").focusin(this.selectOrg);
    $.fn.zTree.init($("#treeDemo"), this.setting);
}

/*function showMenu () {
    $("#menuContent").slideDown("fast");
    $("body").bind("mousedown", onBodyDown);
}*/
function hideMenu() {
    $("#menuContent").slideUp("fast");
    $("body").unbind("mousedown", onBodyDown);
}
function onBodyDown(event) {
    if (!(event.target.id == "menuBtn" || event.target.id == "orgcode" || event.target.id == "menuContent" || $(event.target).parents("#menuContent").length>0)) {
        hideMenu();
    }
}
/*
function getOrgListByCode(orgcoding){
    var url = "http://126.33.50.237:8899/RSComplat/rest/function/org/get"
        $.ajax({
            type: "GET",
            url: url,
            data: {orgcoding:orgcoding},
            dataType: "json",
            success: function(data){
                console.log(data.code);

                $.fn.zTree.init($("#treeDemo"), setting, zNodes);

            }
        });
}
*/

function selectOrg() {
    var cityObj = $("#orgcode");
    var cityOffset = $("#orgcode").offset();
    $("#menuContent").css({left:cityOffset.left + "px", top:cityOffset.top + cityObj.outerHeight() + "px"}).slideDown("fast");
    $("body").bind("mousedown", onBodyDown);
}

function loadjQueryCookies() {
	var jqueryUrl = /*[[@{#{webjars.jquerycookie.js}}]]*/; 
	head.load(jqueryUrl, notifyResourcesAreLoaded(resourceLoadedSuccessfully));
}

function notifyResourcesAreLoaded(callback) {
    if (typeof callback === "function") {
        callback();
    }
}
</script>

<script th:inline="javascript">
    /*<![CDATA[*/

    var trackGeoLocation = /*[[${trackGeoLocation}]]*/ === "true";

    var googleAnalyticsTrackingId = /*[[${googleAnalyticsTrackingId}]]*/;

    if (googleAnalyticsTrackingId != null && googleAnalyticsTrackingId != '') {
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', googleAnalyticsTrackingId, 'auto');
        ga('send', 'pageview');
    }

    /*]]>*/
</script>

<script type="text/javascript" th:if="${recaptchaSiteKey != null AND recaptchaInvisible != null AND recaptchaSiteKey AND recaptchaInvisible}" th:inline="javascript">
    function onSubmit(token) {
        $('#fm1').submit();
    }
</script>
